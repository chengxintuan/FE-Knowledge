# 冯·诺依曼体系结构：计算机组成的金字塔

**计算机的基本硬件组成**

计算机组成的三大件：CPU、内存和主板。

CPU负责计算，内存存储数据，主板提供插槽，CPU和内存要插在主板上。

主板的芯片组和总线解决了CPU和内存之间如何通信的问题。

芯片组控制了数据传输的流转，也就是数据从哪里到哪里的问题。

总线则是实际数据传输的高速公路。因此，总线速度决定了数据能传输得多快。

有了三大件，只要配上电源供电，计算机差不多就可以跑起来了。

当然，我们还需要各自I/O设备，比如鼠标、键盘、显示器。

还有一个很特殊的设备，就是显卡，之所以特殊，是因为显卡里有除了CPU之外的另一个“处理器”，也就是GPU，GPU一样可以做各种“计算”的工作。

主板上的南桥跟北桥，南桥的作用是来连接鼠标、键盘以及硬盘这些外部设备和CPU之间的通信。

北桥的作用，是连接CPU和内存、显卡之间的通信。目前“北桥”芯片的工作，已经被移到了CPU的内部。

**冯·诺依曼体系结构**

任何一台计算机的任何一个部件都可以归到运算器、控制器、存储器、输入设备和输出设备中，而所有的现代计算机也都是基于这个基础架构来设计开发的。

而所有的计算机程序，也都可以抽象为从输入设备读取输入信息，通过运算器和控制器来执行存储在存储器里的程序，最终把结果输出到输出设备中。而我们所有撰写的无论高级还是低级语言的程序，也都是基于这样一个抽象框架来进行运作的。

**总结延伸**

冯·诺依曼体系结构确立了我们现在每天使用的计算机硬件的基础架构。因此，学习计算机组成原理，其实就是学习和拆解冯·诺依曼体系结构。

具体来说，学习组成原理，其实就是学习控制器、运算器的工作原理，也就是CPU是怎么工作的，以及为何这样设计；学习内存的工作原理，从最基本的电路，到上层抽象给到CPU乃至应用程序的接口是怎样的；学习CPU是怎么和输入设备、输出设备打交道的。

学习组成原理，就是在理解从控制器、运算器、存储器、输入设备以及输出设备，从电路这样的硬件，到最终开放给软件的接口，是怎么运作的，为什么要设计成这样，以及在软件开发层面怎么尽可能用好它。

# 给你一张知识地图，计算机组成原理应该这么学

<br/>
<img src='../../images/367.jpg' width='1000'>
<br/>

# 通过你的CPU主频，我们来谈谈“性能”究竟是什么？

计算机的性能，主要有两个指标。

第一个是响应时间 或者叫执行时间。想要提升响应时间这个性能指标，你可以理解为让计算机“跑得更快”。

第二个是吞吐率或者带宽，想要提升这个指标，你可以理解为让计算机“搬得更多”。

提升吞吐率的办法有很多。大部分时候，我们只要多加一些机器，多堆一些硬件就好了。但是响应时间的提升却没有那么容易。

程序的CPU执行时间 = CPU时钟周期数 × 时钟周期时间

时钟周期时间取决于硬件，软件工程师要重点关注CPU时钟周期数。

对于CPU时钟周期数，我们可以再做一个分解，把它变成`指令数 × 每条指令的平均时钟周期数（简称CPI）`

所以，程序的CPU执行时间 = 指令数 × CPI × 时钟周期时间

要解决性能问题，其实就是要优化这三者。

1. 时钟周期时间，就是计算机主频，这个取决于计算机硬件。
2. 每条指令的平均时钟周期数CPI，就是一条指令到底需要多少CPU Cycle。
3. 指令数，代表执行我们的程序到底需要多少条指令、用哪些指令。

# 穿越功耗墙，我们该从哪些方面提升“性能”？

我们知道CPU的性能，取决于：程序的CPU执行时间 = 指令数 × CPI × 时钟周期时间

1978年到2000年里，提升CPU性能的主要方式是不断提升CPU的时钟频率。

主要是两个措施：增加密度、提升主频。

增加密度，就是同样的面积里面，多放一些晶体管。

提升主频，就是让晶体管“打开”和“关闭”得更快一点。

而这两者，都会增加功耗，带来耗电和散热的问题。这也是限制CPU主频提升的主要原因。

一个CPU的功率，可以用这样一个公式来表示：

`功耗 ~= 1/2 ×负载电容×电压的平方×开关频率×晶体管数量`

为了要提升性能，我们需要不断地增加晶体管数量。同样的面积下，我们想要多放一点晶体管，就要把晶体管造得小一点。这个就是平时我们所说的提升“制程”。

从28nm到7nm，相当于晶体管本身变成了原来的1/4大小。这个就相当于我们在工厂里，同样的活儿，我们要找瘦小一点的工人，这样一个工厂里面就可以多一些人。我们还要提升主频，让开关的频率变快，也就是要找手脚更快的工人。

但是，功耗增加太多，就会导致CPU散热跟不上，这时，我们就需要降低电压。

事实上，从5MHz主频的8086到5GHz主频的Intel i9，CPU的电压已经从5V左右下降到了1V左右。这也是为什么我们CPU的主频提升了1000倍，但是功耗只增长了40倍。

制程的优化和电压的下降，是通过提升主频提升性能。到从奔腾4开始，这个提升已经到了极限。

上一讲，我们知道影响性能有两个指标：响应时间跟吞吐量。

既然响应时间改变不了，就提升吞吐量。

我们现在用的2核、4核，乃至8核的CPU，性能也就成倍提升。

提升响应时间，就好比提升你用的交通工具的速度，比如原本你是开汽车，现在变成了火车乃至飞机。本来开车从上海到北京要20个小时，换成飞机就只要2个小时了，但是，在此之上，再想要提升速度就不太容易了。我们的CPU在奔腾4的年代，就好比已经到了飞机这个速度极限。

那你可能要问了，接下来该怎么办呢？相比于给飞机提速，工程师们又想到了新的办法，可以一次同时开2架、4架乃至8架飞机。虽然从上海到北京的时间没有变，但是一次飞8架飞机能够运的东西自然就变多了，也就是所谓的“吞吐率”变大了。

这也是一个最常见的提升性能的方式，通过并行提高性能。

